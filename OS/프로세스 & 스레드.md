# 프로세스 & 스레드

## Process

위키백과에 따르면 프로세스는 컴퓨터에 연속적으로 **실행되고 있는 컴퓨터 프로그램**을 말한다. 스케줄링의 대상이 되는 **작업**이라는 용어와 거의 같은 의미로 쓰인다.

운영체제로부터 시스템 자원을 할당받는 작업 단위

기본적으로 프로세스당 최소 1개의 스레드를 가진다.

프로세스는 독립된 메모리 영역을 할당 받는다.

별도의 주소 공간에서 실행되며, 다른 프로세스의 주소 공간에 접근 할 수 없다.

프로세스간의 데이터 통신을 위해 IPC(Inter-Process Communication)을 통해 데이터를 주고 받을 수 있음

* 프로그램 : 작업을 위해 실행 할 수 파일

**구조**

Code, Data, Stack, Heap 4가지 영역

- **Code**
    - text 영역
    - 실행될 code가 저장되는 영역
    - 실행할 프로그램의 코드가 저장되는 영역
    - CPU가 이 영역의 저장된 명령어를 하나씩 가져와 수행
    - 프로그램이 시작되고 끝날때까지 메모리 영역에 유지
- **Data**
    - 전역 변수와 정적(static) 변수가 저장되는 영역
    - 프로그램 시작 시 할당 종료될 때 해제
    - BSS와 GVAR영역을 통틀어서 data 영역이라 함.
        - BSS: 초기화 되지 않은 데이터를 저장하기 위한 영역(RAM저장)
        - GVAR : 초기화 된 데이터를 저장하기 위한 영역 ( ROM저장)
        
        초기화 되지 않는 데이터와 초기화 된 데이터를 구분하는 이유? 초기화 되지 않는 변수는 실행될 때 영역만 잡아주면 되고 초기화 된 데이터는 값도 가지고 있어야 하기 때문이다. BSS영역의 변수들은 프로그램 코드 실행 사이즈를 늘리지 않는다.
        
- **Stack**
    - 프로그램에 의해 사용되는 임시 데이터 영역
    - 함수 호출 시 생성되는 지역변수, 매개 변수를 저장, 종료 시 해제
    - 메모리 주소는 높은 곳에서 낮은 곳으로 할당
- **Heap**
    - 프로그래머에 의해 할당/ 해제
    - 메모리를 동적 할당하여 사용
    - 스택과 반대로 낮은 곳에서 높은 곳으로 할당

**멀티프로세스**

여러 개의 프로세스가 작업을 병렬 처리 

같은 프로그램을 동시에 병렬 처리

각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 때 사용

**장점**

- 독립된 구조로 안정성이 높음
- 하나의 프로세스가 죽는다 하더라도 속도는 느려질 수 있더라도 문제가 커지지 않는다.

**단점**

- 멀티 스레드보다 많은 공간과 CPU시간을 차지
- Context-Swithing 오버헤드 발생할 수 있다.

 * Context-Swithing : CPU는 한번에 하나의 프로세스만 실행 가능하므로 돌아가면서 작업을 처리하는 과정을 말하며, 프로세스가 대기하면서 해당 프로세스 상태를 보관하고 대기하던 순서의 프로세스가 동작하면서 이전 보관했던 프로세스의 상태를 복구하는 작업

## Thread

프로세스 내에서 실행되는 흐름의 단위

프로세스 내에서 실제 작업을 수행하는 주체

한 프로그램이 둘 이상의 스레드를 동시에 실행한다면 멀티 스레드 환경이라고 함

스레드는 프로세스 내에서 Stack만 할당 받고 code,data,heap 영역은 공유

프로세스 내의 주소 공간과 자원들을 같은 프로세스 내에 스레드 끼리 공유하며 실행

스레드는 별도의 Register와 Stack을 갖고 Heap 메모리는 서로 읽고 쓸 수 있음

**멀티스레드**

하나의 작업을 위해 프로세스에서 여러 스레드를 생성해 여러 CPU 코어를 사용하기 위한 작업

**장점**

- 멀티프로세스보다 적은 메모리 공간
- 스레드 간의 작업량이 적기 때문에 Context Switching 이 빠르다
- 프로세스간의 통신보다 비용이 적기 때문에 자원소모 감소
- 힙 영역을 공유하여 데이터를 주고 받을 수 있음

**단점**

- 자원을 공유하기 때문에 동기화 문제가 까다롭다 ( 병목현상 , 데드락)
- 하나의 스레드가 문제가 발생하면 전체 프로세스에 영향을 끼친다
- 스레드가 개별로 움직이고 있기 때문에 디버깅하기가 까다롭다.